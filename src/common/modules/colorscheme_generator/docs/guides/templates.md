# Templates Guide

**Module:** `colorscheme_generator`  
**Last Updated:** 2025-10-18

---

## Overview

The `colorscheme_generator` module uses Jinja2 templates to render ColorScheme objects to various output formats. This guide explains how to work with templates.

---

## Template System

### Template Location

```
colorscheme_generator/
└── templates/
    ├── colors.json.j2
    ├── colors.css.j2
    ├── colors.sh.j2
    └── colors.yaml.j2
```

### Template Context

All templates receive the same context:

```python
{
    "background": Color,      # Background color
    "foreground": Color,      # Foreground color
    "cursor": Color,          # Cursor color
    "colors": list[Color],    # 16 terminal colors (0-15)
    "source_image": Path,     # Source image path
    "backend": str,           # Backend name
    "generated_at": datetime, # Generation timestamp
}
```

### Color Object

Each Color object has:

```python
color.hex  # "#FF5733"
color.rgb  # (255, 87, 51)
color.hsl  # (12.0, 1.0, 0.6) or None
```

---

## Built-in Templates

### JSON Template

**File:** `templates/colors.json.j2`

```jinja2
{
  "special": {
    "background": "{{ background.hex }}",
    "foreground": "{{ foreground.hex }}",
    "cursor": "{{ cursor.hex }}"
  },
  "colors": {
    {% for i in range(16) %}
    "color{{ i }}": "{{ colors[i].hex }}"{% if not loop.last %},{% endif %}
    {% endfor %}
  },
  "metadata": {
    "source_image": "{{ source_image }}",
    "backend": "{{ backend }}",
    "generated_at": "{{ generated_at.isoformat() }}"
  }
}
```

**Output:**
```json
{
  "special": {
    "background": "#1a1a1a",
    "foreground": "#ffffff",
    "cursor": "#ff0000"
  },
  "colors": {
    "color0": "#000000",
    "color1": "#ff0000",
    ...
  }
}
```

### CSS Template

**File:** `templates/colors.css.j2`

```jinja2
/* Generated by colorscheme_generator */
/* Source: {{ source_image }} */
/* Backend: {{ backend }} */
/* Generated: {{ generated_at }} */

:root {
  /* Special colors */
  --background: {{ background.hex }};
  --foreground: {{ foreground.hex }};
  --cursor: {{ cursor.hex }};
  
  /* Terminal colors */
  {% for i in range(16) %}
  --color{{ i }}: {{ colors[i].hex }};
  {% endfor %}
  
  /* RGB values */
  --background-rgb: {{ background.rgb[0] }}, {{ background.rgb[1] }}, {{ background.rgb[2] }};
  --foreground-rgb: {{ foreground.rgb[0] }}, {{ foreground.rgb[1] }}, {{ foreground.rgb[2] }};
}
```

**Output:**
```css
:root {
  --background: #1a1a1a;
  --foreground: #ffffff;
  --cursor: #ff0000;
  
  --color0: #000000;
  --color1: #ff0000;
  ...
  
  --background-rgb: 26, 26, 26;
  --foreground-rgb: 255, 255, 255;
}
```

### Shell Template

**File:** `templates/colors.sh.j2`

```jinja2
#!/bin/sh
# Generated by colorscheme_generator
# Source: {{ source_image }}
# Backend: {{ backend }}
# Generated: {{ generated_at }}

# Special colors
background="{{ background.hex }}"
foreground="{{ foreground.hex }}"
cursor="{{ cursor.hex }}"

# Terminal colors
{% for i in range(16) %}
color{{ i }}="{{ colors[i].hex }}"
{% endfor %}

# Export for use in other scripts
export COLORSCHEME_BACKGROUND="$background"
export COLORSCHEME_FOREGROUND="$foreground"
export COLORSCHEME_CURSOR="$cursor"
{% for i in range(16) %}
export COLORSCHEME_COLOR{{ i }}="$color{{ i }}"
{% endfor %}
```

**Output:**
```bash
#!/bin/sh
background="#1a1a1a"
foreground="#ffffff"
cursor="#ff0000"

color0="#000000"
color1="#ff0000"
...

export COLORSCHEME_BACKGROUND="$background"
...
```

### YAML Template

**File:** `templates/colors.yaml.j2`

```jinja2
# Generated by colorscheme_generator
# Source: {{ source_image }}
# Backend: {{ backend }}

special:
  background: "{{ background.hex }}"
  foreground: "{{ foreground.hex }}"
  cursor: "{{ cursor.hex }}"

colors:
  {% for i in range(16) %}
  color{{ i }}: "{{ colors[i].hex }}"
  {% endfor %}

metadata:
  source_image: "{{ source_image }}"
  backend: "{{ backend }}"
  generated_at: "{{ generated_at.isoformat() }}"
```

**Output:**
```yaml
special:
  background: "#1a1a1a"
  foreground: "#ffffff"
  cursor: "#ff0000"

colors:
  color0: "#000000"
  color1: "#ff0000"
  ...
```

---

## Creating Custom Templates

### Step 1: Create Template File

```bash
cd colorscheme_generator/templates
touch colors.toml.j2
```

### Step 2: Write Template

```jinja2
# colors.toml.j2
# Generated by colorscheme_generator
# Source: {{ source_image }}

[special]
background = "{{ background.hex }}"
foreground = "{{ foreground.hex }}"
cursor = "{{ cursor.hex }}"

[colors]
{% for i in range(16) %}
color{{ i }} = "{{ colors[i].hex }}"
{% endfor %}

[metadata]
source_image = "{{ source_image }}"
backend = "{{ backend }}"
generated_at = "{{ generated_at.isoformat() }}"
```

### Step 3: Add Format to Enum

```python
# config/enums.py
class ColorFormat(str, Enum):
    JSON = "json"
    CSS = "css"
    SHELL = "sh"
    YAML = "yaml"
    TOML = "toml"  # Add this
```

### Step 4: Use It

```python
from colorscheme_generator.config.enums import ColorFormat

output_files = manager.write_outputs(
    scheme,
    output_dir,
    [ColorFormat.TOML]
)
```

---

## Advanced Template Techniques

### Using RGB Values

```jinja2
/* RGB values */
background-rgb: rgb({{ background.rgb[0] }}, {{ background.rgb[1] }}, {{ background.rgb[2] }});
```

### Using HSL Values (if available)

```jinja2
{% if background.hsl %}
background-hsl: hsl({{ background.hsl[0] }}, {{ background.hsl[1] * 100 }}%, {{ background.hsl[2] * 100 }}%);
{% endif %}
```

### Conditional Rendering

```jinja2
{% if backend == "pywal" %}
/* Generated with pywal */
{% elif backend == "wallust" %}
/* Generated with wallust */
{% else %}
/* Generated with custom backend */
{% endif %}
```

### Loops with Indices

```jinja2
{% for color in colors %}
color{{ loop.index0 }}: {{ color.hex }}  /* {{ loop.index0 }}: 0-15 */
{% endfor %}
```

### Named Colors

```jinja2
{% set color_names = ["black", "red", "green", "yellow", "blue", "magenta", "cyan", "white"] %}

/* Normal colors */
{% for i in range(8) %}
{{ color_names[i] }}: {{ colors[i].hex }};
{% endfor %}

/* Bright colors */
{% for i in range(8) %}
bright-{{ color_names[i] }}: {{ colors[i + 8].hex }};
{% endfor %}
```

### Filters

```jinja2
/* Uppercase hex */
background: {{ background.hex | upper }};

/* Formatted timestamp */
generated: {{ generated_at.strftime("%Y-%m-%d %H:%M:%S") }};

/* Basename of source image */
source: {{ source_image.name }};
```

---

## Template Examples

### Example 1: Xresources Template

```jinja2
! Generated by colorscheme_generator
! Source: {{ source_image }}

*background: {{ background.hex }}
*foreground: {{ foreground.hex }}
*cursorColor: {{ cursor.hex }}

{% set color_names = ["black", "red", "green", "yellow", "blue", "magenta", "cyan", "white"] %}
{% for i in range(8) %}
*color{{ i }}: {{ colors[i].hex }}
*color{{ i + 8 }}: {{ colors[i + 8].hex }}
{% endfor %}
```

### Example 2: Lua Template (for Neovim)

```jinja2
-- Generated by colorscheme_generator
-- Source: {{ source_image }}

return {
  background = "{{ background.hex }}",
  foreground = "{{ foreground.hex }}",
  cursor = "{{ cursor.hex }}",
  
  colors = {
    {% for i in range(16) %}
    "{{ colors[i].hex }}",
    {% endfor %}
  },
  
  named = {
    black = "{{ colors[0].hex }}",
    red = "{{ colors[1].hex }}",
    green = "{{ colors[2].hex }}",
    yellow = "{{ colors[3].hex }}",
    blue = "{{ colors[4].hex }}",
    magenta = "{{ colors[5].hex }}",
    cyan = "{{ colors[6].hex }}",
    white = "{{ colors[7].hex }}",
  }
}
```

### Example 3: Python Template

```jinja2
# Generated by colorscheme_generator
# Source: {{ source_image }}

BACKGROUND = "{{ background.hex }}"
FOREGROUND = "{{ foreground.hex }}"
CURSOR = "{{ cursor.hex }}"

COLORS = [
    {% for color in colors %}
    "{{ color.hex }}",
    {% endfor %}
]

COLOR_NAMES = {
    "black": COLORS[0],
    "red": COLORS[1],
    "green": COLORS[2],
    "yellow": COLORS[3],
    "blue": COLORS[4],
    "magenta": COLORS[5],
    "cyan": COLORS[6],
    "white": COLORS[7],
}
```

---

## Template Testing

### Test Template Rendering

```python
from jinja2 import Environment, FileSystemLoader
from pathlib import Path

# Setup Jinja2
template_dir = Path("colorscheme_generator/templates")
env = Environment(loader=FileSystemLoader(template_dir))

# Load template
template = env.get_template("colors.toml.j2")

# Render with test data
context = {
    "background": Color(hex="#1a1a1a", rgb=(26, 26, 26)),
    "foreground": Color(hex="#ffffff", rgb=(255, 255, 255)),
    "cursor": Color(hex="#ff0000", rgb=(255, 0, 0)),
    "colors": [Color(hex=f"#{i:02x}{i:02x}{i:02x}", rgb=(i, i, i)) for i in range(16)],
    "source_image": Path("/path/to/image.png"),
    "backend": "test",
    "generated_at": datetime.now(),
}

output = template.render(**context)
print(output)
```

---

## Next Steps

- **[Usage Patterns](usage_patterns.md)** - Common usage patterns
- **[Integration](integration.md)** - Integration examples
- **[Examples](../reference/examples.md)** - Comprehensive examples

